package innsendtsoeknad.common

import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule
import com.fasterxml.jackson.module.kotlin.jacksonObjectMapper
import com.fasterxml.jackson.module.kotlin.jacksonTypeRef
import io.kotest.matchers.ints.shouldBeExactly
import io.kotest.matchers.shouldBe
import no.nav.etterlatte.libs.common.innsendtsoeknad.common.SoeknadRequest
import org.junit.jupiter.api.Test

internal class InnsendtSoeknadTest {

    private val mapper = jacksonObjectMapper()
        .registerModule(JavaTimeModule())

    @Test
    fun `Deserialisering fungerer som forventet`() {
        val json = """{"soeknader":[{"type":"GJENLEVENDEPENSJON","imageTag":"13jir81j3r-13rj138jr89j","harSamtykket":{"spoersmaal":"Jeg, STOR SNERK, bekrefter at jeg vil gi riktige og fullstendige opplysninger.","svar":true},"innsender":{"type":"INNSENDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"}},"utbetalingsInformasjon":{"spoersmaal":"Ønsker du å motta utbetalingen på norsk eller utenlandsk bankkonto?","svar":{"verdi":"NORSK","innhold":"Norsk"},"opplysning":{"kontonummer":{"spoersmaal":"Oppgi norsk kontonummer for utbetaling","svar":{"innhold":"1351.35.13513"}}}},"soeker":{"type":"GJENLEVENDE","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"},"statsborgerskap":"Statsborgerskap-mock","sivilstatus":"Sivilstatus-mock","adresse":{"spoersmaal":"Bostedsadresse","svar":"Adresse-mock 1, 0000 Poststed-mock"},"bostedsAdresse":{"spoersmaal":"Bor du på denne adressen?","svar":{"verdi":"NEI","innhold":"Nei"},"opplysning":{"spoersmaal":"Oppgi nåværende bostedsadresse","svar":{"innhold":"Testveien 123, 0594 Oslo"}}},"kontaktinfo":{"epost":{"spoersmaal":"E-post (valgfri)","svar":{"innhold":"test@nav.no"}},"telefonnummer":{"spoersmaal":"Telefonnummer (valgfri)","svar":{"innhold":"999 88 777"}}},"oppholdUtland":{"spoersmaal":"Oppholder du deg for tiden i Norge?","svar":{"verdi":"JA","innhold":"Ja"}},"nySivilstatus":{"spoersmaal":"Sivilstanden din i dag","svar":{"verdi":"ENSLIG","innhold":"Enslig"}},"arbeidOgUtdanning":{"dinSituasjon":{"spoersmaal":"Hva er situasjonen din nå?","svar":[{"verdi":"ARBEIDSTAKER","innhold":"Jeg er arbeidstaker"}]},"arbeidsforhold":{"spoersmaal":"Om arbeidsgiver","svar":[{"arbeidsgiver":{"spoersmaal":"Hva heter arbeidsgiver?","svar":{"innhold":"Potetskreller AS"}},"ansettelsesforhold":{"spoersmaal":"Type ansettelse","svar":{"verdi":"MIDLERTIDIG","innhold":"Midlertidig ansatt"}},"stillingsprosent":{"spoersmaal":"Hvor mye jobber du?","svar":{"innhold":"100%"}},"endretInntekt":{"spoersmaal":"Regner du med at inntekten din endrer seg de neste 12 månedene?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"spoersmaal":"Hva er grunnen til endringene?","svar":{"innhold":"Forventer økt inntekt"}}}}]}},"fullfoertUtdanning":{"spoersmaal":"Hva er din høyeste fullførte utdanning?","svar":{"verdi":"UNIVERSITET_OVER_4_AAR","innhold":"Universitet eller høyskole mer enn 4 år"}},"andreYtelser":{"kravOmAnnenStonad":{"spoersmaal":"Har du søkt om andre ytelser som du ikke har fått svar på?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"spoersmaal":"Hva har du søkt om?","svar":{"verdi":"DAGPENGER","innhold":"Dagpenger"}}},"annenPensjon":{"spoersmaal":"Får du eller har du søkt om avtalefestet pensjon (AFP) eller annen pensjon fra andre enn NAV?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"spoersmaal":"Hvilken pensjonsordning?","svar":{"innhold":"Skandia"}}},"pensjonUtland":{"spoersmaal":"Mottar du pensjon fra et annet land enn Norge?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"pensjonsType":{"spoersmaal":"Hva slags pensjon?","svar":{"innhold":"Polsk Uførepensjon"}},"land":{"spoersmaal":"Fra hvilket land?","svar":{"innhold":"Polen"}},"bruttobeloepPrAar":{"spoersmaal":"Årlig beløp før skatt i landets valuta","svar":{"innhold":"4000 PLN"}}}}},"uregistrertEllerVenterBarn":{"spoersmaal":"Venter du barn eller har du barn som enda ikke er registrert i folkeregisteret?","svar":{"verdi":"JA","innhold":"Ja"}},"forholdTilAvdoede":{"relasjon":{"spoersmaal":"Relasjonen din til avdøde da dødsfallet skjedde","svar":{"verdi":"SEPARERT","innhold":"Separert"}},"datoForInngaattPartnerskap":{"spoersmaal":"Vi giftet oss","svar":{"innhold":"2001-07-26T22:00:00.000Z"}}}},"avdoed":{"type":"AVDOED","fornavn":{"spoersmaal":"Fornavn","svar":"Død"},"etternavn":{"spoersmaal":"Etternavn","svar":"Testperson"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"24014021406"},"datoForDoedsfallet":{"spoersmaal":"Når skjedde dødsfallet?","svar":{"innhold":"2021-07-26T22:00:00.000Z"}},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":{"innhold":"Norsk"}},"utenlandsopphold":{"spoersmaal":"Bodde eller arbeidet han eller hun i et annet land enn Norge etter fylte 16 år?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":[{"land":{"spoersmaal":"Land","svar":{"innhold":"Kongo"}},"fraDato":{"spoersmaal":"Fra dato (valgfri)","svar":{"innhold":"2002-08-10T22:00:00.000Z"}},"tilDato":{"spoersmaal":"Til dato (valgfri)","svar":{"innhold":"2003-08-10T22:00:00.000Z"}},"oppholdsType":{"spoersmaal":"Bodd og/eller arbeidet?","svar":[{"verdi":"BODD","innhold":"Bodd"},{"verdi":"ARBEIDET","innhold":"Arbeidet"}]},"medlemFolketrygd":{"spoersmaal":"Var han eller hun medlem av folketrygden under oppholdet?","svar":{"verdi":"JA","innhold":"Ja"}},"pensjonsutbetaling":{"spoersmaal":"Oppgi eventuell pensjon han eller hun mottok fra dette landet (valgfri)","svar":{"innhold":"150.000"}}}]},"naeringsInntekt":{"spoersmaal":"Var han eller hun selvstendig næringsdrivende?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"naeringsinntektPrAarFoerDoedsfall":{"spoersmaal":"Oppgi næringsinntekt fra kalenderåret før dødsfallet (valgfri)","svar":{"innhold":"150 000"}},"naeringsinntektVedDoedsfall":{"spoersmaal":"Hadde han eller hun næringsinntekt når dødsfallet skjedde?","svar":{"verdi":"NEI","innhold":"Nei"}}}},"militaertjeneste":{"spoersmaal":"Har han eller hun gjennomført militær eller sivil førstegangstjeneste som varte minst 30 dager?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"spoersmaal":"Hvilke(-t) år? (valgfri)","svar":{"innhold":"1984"}}},"doedsaarsakSkyldesYrkesskadeEllerYrkessykdom":{"spoersmaal":"Skyldes dødsfallet yrkesskade eller yrkessykdom?","svar":{"verdi":"JA","innhold":"Ja"}}},"barn":[{"type":"BARN","fornavn":{"spoersmaal":"Fornavn","svar":"Treg"},"etternavn":{"spoersmaal":"Etternavn","svar":"Snøfreser"},"foedselsnummer":{"spoersmaal":"Barnets fødselsnummer / d-nummer","svar":"24014021406"},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":"Norsk"},"utenlandsAdresse":{"spoersmaal":"Bor barnet i et annet land enn Norge?","svar":{"verdi":"NEI","innhold":"Nei"}},"foreldre":[{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"}},{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"Død"},"etternavn":{"spoersmaal":"Etternavn","svar":"Testperson"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"24014021406"}}],"verge":{"spoersmaal":"Er det oppnevnt en verge for barnet?","svar":{"verdi":"NEI","innhold":"Nei"}}},{"type":"BARN","fornavn":{"spoersmaal":"Fornavn","svar":"Lunken"},"etternavn":{"spoersmaal":"Etternavn","svar":"Floskel"},"foedselsnummer":{"spoersmaal":"Barnets fødselsnummer / d-nummer","svar":"07010776133"},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":"Norsk"},"utenlandsAdresse":{"spoersmaal":"Bor barnet i et annet land enn Norge?","svar":{"verdi":"NEI","innhold":"Nei"}},"foreldre":[{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"}},{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"Død"},"etternavn":{"spoersmaal":"Etternavn","svar":"Testperson"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"24014021406"}}],"verge":{"spoersmaal":"Er det oppnevnt en verge for barnet?","svar":{"verdi":"NEI","innhold":"Nei"}}}]},{"type":"BARNEPENSJON","imageTag":"13jir81j3r-13rj138jr89j","innsender":{"type":"INNSENDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"}},"harSamtykket":{"spoersmaal":"","svar":true},"utbetalingsInformasjon":{"spoersmaal":"Ønsker du å motta utbetalingen på norsk eller utenlandsk bankkonto?","svar":{"verdi":"NORSK","innhold":"Norsk"},"opplysning":{"kontonummer":{"spoersmaal":"Oppgi norsk kontonummer for utbetaling","svar":{"innhold":"1351.35.13513"}},"skattetrekk":{"spoersmaal":"Ønsker du at vi legger inn et skattetrekk for barnepensjonen?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"spoersmaal":"Oppgi ønsket skattetrekk","svar":{"innhold":"21%"}}}}},"soeker":{"type":"BARN","fornavn":{"spoersmaal":"Fornavn","svar":"Lunken"},"etternavn":{"spoersmaal":"Etternavn","svar":"Floskel"},"foedselsnummer":{"spoersmaal":"Barnets fødselsnummer / d-nummer","svar":"07010776133"},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":"Norsk"},"utenlandsAdresse":{"spoersmaal":"Bor barnet i et annet land enn Norge?","svar":{"verdi":"NEI","innhold":"Nei"}},"foreldre":[{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"}},{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"Død"},"etternavn":{"spoersmaal":"Etternavn","svar":"Testperson"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"24014021406"}}],"verge":{"spoersmaal":"Er det oppnevnt en verge for barnet?","svar":{"verdi":"NEI","innhold":"Nei"}}},"foreldre":[{"type":"GJENLEVENDE_FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":"Statsborgerskap-mock"},"adresse":{"spoersmaal":"Bostedsadresse","svar":"Adresse-mock 1, 0000 Poststed-mock"},"kontaktinfo":{"epost":{"spoersmaal":"E-post (valgfri)","svar":{"innhold":"test@nav.no"}},"telefonnummer":{"spoersmaal":"Telefonnummer (valgfri)","svar":{"innhold":"999 88 777"}}}},{"type":"AVDOED","fornavn":{"spoersmaal":"Fornavn","svar":"Død"},"etternavn":{"spoersmaal":"Etternavn","svar":"Testperson"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"24014021406"},"datoForDoedsfallet":{"spoersmaal":"Når skjedde dødsfallet?","svar":{"innhold":"2021-07-26T22:00:00.000Z"}},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":{"innhold":"Norsk"}},"utenlandsopphold":{"spoersmaal":"Bodde eller arbeidet han eller hun i et annet land enn Norge etter fylte 16 år?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":[{"land":{"spoersmaal":"Land","svar":{"innhold":"Kongo"}},"fraDato":{"spoersmaal":"Fra dato (valgfri)","svar":{"innhold":"2002-08-10T22:00:00.000Z"}},"tilDato":{"spoersmaal":"Til dato (valgfri)","svar":{"innhold":"2003-08-10T22:00:00.000Z"}},"oppholdsType":{"spoersmaal":"Bodd og/eller arbeidet?","svar":[{"verdi":"BODD","innhold":"Bodd"},{"verdi":"ARBEIDET","innhold":"Arbeidet"}]},"medlemFolketrygd":{"spoersmaal":"Var han eller hun medlem av folketrygden under oppholdet?","svar":{"verdi":"JA","innhold":"Ja"}},"pensjonsutbetaling":{"spoersmaal":"Oppgi eventuell pensjon han eller hun mottok fra dette landet (valgfri)","svar":{"innhold":"150.000"}}}]},"naeringsInntekt":{"spoersmaal":"Var han eller hun selvstendig næringsdrivende?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"naeringsinntektPrAarFoerDoedsfall":{"spoersmaal":"Oppgi næringsinntekt fra kalenderåret før dødsfallet (valgfri)","svar":{"innhold":"150 000"}},"naeringsinntektVedDoedsfall":{"spoersmaal":"Hadde han eller hun næringsinntekt når dødsfallet skjedde?","svar":{"verdi":"NEI","innhold":"Nei"}}}},"militaertjeneste":{"spoersmaal":"Har han eller hun gjennomført militær eller sivil førstegangstjeneste som varte minst 30 dager?","svar":{"verdi":"JA","innhold":"Ja"},"opplysning":{"spoersmaal":"Hvilke(-t) år? (valgfri)","svar":{"innhold":"1984"}}},"doedsaarsakSkyldesYrkesskadeEllerYrkessykdom":{"spoersmaal":"Skyldes dødsfallet yrkesskade eller yrkessykdom?","svar":{"verdi":"JA","innhold":"Ja"}}}],"soesken":[{"type":"BARN","fornavn":{"spoersmaal":"Fornavn","svar":"Treg"},"etternavn":{"spoersmaal":"Etternavn","svar":"Snøfreser"},"foedselsnummer":{"spoersmaal":"Barnets fødselsnummer / d-nummer","svar":"24014021406"},"statsborgerskap":{"spoersmaal":"Statsborgerskap","svar":"Norsk"},"utenlandsAdresse":{"spoersmaal":"Bor barnet i et annet land enn Norge?","svar":{"verdi":"NEI","innhold":"Nei"}},"foreldre":[{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"STOR"},"etternavn":{"spoersmaal":"Etternavn","svar":"SNERK"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"11057523044"}},{"type":"FORELDER","fornavn":{"spoersmaal":"Fornavn","svar":"Død"},"etternavn":{"spoersmaal":"Etternavn","svar":"Testperson"},"foedselsnummer":{"spoersmaal":"Fødselsnummer","svar":"24014021406"}}],"verge":{"spoersmaal":"Er det oppnevnt en verge for barnet?","svar":{"verdi":"NEI","innhold":"Nei"}}}]}]}"""

        val deserialized = mapper.readValue(json, jacksonTypeRef<SoeknadRequest>())

        deserialized.soeknader.size shouldBeExactly 2

        val gjenlevendepensjon = deserialized.soeknader.first()
        gjenlevendepensjon.type shouldBe SoeknadType.GJENLEVENDEPENSJON
        gjenlevendepensjon.template() shouldBe "gjenlevendepensjon_v2"

        val barnepensjon = deserialized.soeknader.last()
        barnepensjon.type shouldBe SoeknadType.BARNEPENSJON
        barnepensjon.template() shouldBe "barnepensjon_v2"
    }
}
